define(["connecta.portal"],function(portal){return portal.directive("menu",function(){return{templateUrl:"app/portal/layout/directive/template/menu.html",controller:["$scope","$location","$menu",function($scope,$location,$menu){$scope.isActive=function(item){var active=false;if(item.activeIf){active=new RegExp(item.activeIf).test($location.url())}else if(item.href){var regex=item.href+"($|[/].*)";active=new RegExp(regex).test($location.url())}if(item.children&&item.children.length){var activeChildren=item.children.filter(function(child){return $scope.isActive(child)});active=active||activeChildren.length>0}return active};$scope.toggle=function(item){if(item.children&&item.children.length){item.opened=!item.opened}};$scope.isOpened=function(item){return item.opened};$scope.menu=$menu.getCurrent();$scope.$on("menu.change",function(event,newMenu){$scope.menu=newMenu});$scope.$on("layout.modulechange",function($event,module){$scope.currentModule=module})}]}})});